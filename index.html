<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Netlify Functions 示例</title>
</head>
<body>
  <h1>表单提交与天气查询</h1>

  <!-- 表单提交 -->
  <h2>提交表单_v1.0</h2>
  <form id="contactForm">
    <input type="text" id="name" placeholder="姓名" required /><br/>
    <input type="email" id="email" placeholder="邮箱" required /><br/>
    <textarea id="message" placeholder="留言"></textarea><br/>
    <button type="submit">提交</button>
  </form>
  <p id="formResult"></p>

  <!-- 天气查询 -->
  <h2>查询天气</h2>
  <input type="text" id="city" placeholder="城市名称" value="Beijing" />
  <button onclick="getWeather()">查询天气</button>
  <div id="weatherResult"></div>

  <script>
    // 提交表单
    document.getElementById('contactForm').addEventListener('submit', async (e) => 
	{
      e.preventDefault();
      const formData = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        message: document.getElementById('message').value
      };

      const res = await fetch('/.netlify/functions/submit-form', {
        method: 'POST',
        body: JSON.stringify(formData)
      });

      const data = await res.json();
      document.getElementById('formResult').textContent = data.message || data.data || data.error;
    });

    // 获取天气
    async function getWeather() 
	{
      const city = document.getElementById('city').value;
      const res = await fetch('//.netlify/functions/get-weather?city=${city}');
      const data = await res.json();

      const weatherDiv = document.getElementById('weatherResult');
      if (data.error) 
	  {
        weatherDiv.innerHTML = `<p style="color:red">${data.error}</p>`;
      } 
	  else 
	  {
        weatherDiv.innerHTML = `
          <h3>${data.city} 天气</h3>
          <p>温度: ${data.temperature}°C</p>
          <p>描述: ${data.description}</p>
          <p>湿度: ${data.humidity}%</p>
        `;
      }
    }
  </script>
</body>
</html>